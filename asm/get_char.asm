GLOBAL get_char

-- [_, _] -> [char, _]
-- crash [0xF00F, _] if shift TODO
get_char:
  KEY_A A_B
  RAM_AL 0xAA SUB JMPRZ $shift
  RAM_AL 0xE0 SUB JMPRZ $get_char
  RAM_AL 0x2A SUB JMPRZ $get_char
  RAM_AL 0x80 SUB JMPRNN $get_char
  RAM_A scancode_to_ascii SUM A_B rB_AL
  RET

shift:
  KEY_A RAM_B scancode_to_ascii_shift SUM A_B rB_AL
  RET

scancode_to_ascii:
--   0    1    2    3    4    5    6    7
--   8    9    A    B    C    D    E    F
  0x00 0x01  "1"  "2"  "3"  "4"  "5"  "6" -- 0
   "7"  "8"  "9"  "0"  "-"  "=" 0x0E 0x0F -- 0
   "q"  "w"  "e"  "r"  "t"  "y"  "u"  "i" -- 1
   "o"  "p"  "["  "]" 0x0A 0x1D  "a"  "s" -- 1
   "d"  "f"  "g"  "h"  "j"  "k"  "l"  ";" -- 2
   "'"  "`" 0x2A 0x2B  "z"  "x"  "c"  "v" -- 2
   "b"  "n"  "m"  ","  "."  "/" 0x36 0x37 -- 3
  0x38  " " 0x3A 0x3B 0x3C 0x3D 0x3E 0x3F -- 3
  0x40 0x41 0x42 0x43 0x44 0x45 0x46 0x47 -- 4
  0x48 0x49 0x4A 0x4B 0x4C 0x4D 0x4E 0x4F -- 4
  0x50 0x51 0x52 0x53 0x54 0x55 0x56 0x57 -- 5
  0x58 0x59 0x5A 0x5B 0x5C 0x5D 0x5E 0x5F -- 5
  0x60 0x61 0x62 0x63 0x64 0x65 0x66 0x67 -- 6
  0x68 0x69 0x6A 0x6B 0x6C 0x6D 0x6E 0x6F -- 6
  0x70 0x71 0x72 0x73 0x74 0x75 0x76 0x77 -- 7
  0x78 0x79 0x7A 0x7B 0x7C 0x7D 0x7E 0x7F -- 7

scancode_to_ascii_shift:
--   0    1    2    3    4    5    6    7
--   8    9    A    B    C    D    E    F
  0x00 0x01  "1"  "2"  "3"  "4"  "5"  "6" -- 0
   "7"  "8"  "9"  "0"  "_"  "=" 0X0E 0X0F -- 0
   "Q"  "W"  "E"  "R"  "T"  "Y"  "U"  "I" -- 1
   "O"  "P"  "["  "]" 0X0A 0X1D  "A"  "S" -- 1
   "D"  "F"  "G"  "H"  "J"  "K"  "L"  ";" -- 2
   "'"  "`" 0X2A 0X2B  "Z"  "X"  "C"  "V" -- 2
   "B"  "N"  "M"  ","  "."  "/" 0X36 0X37 -- 3
  0x38  " " 0x3A 0x3B 0x3C 0x3D 0x3E 0x3F -- 3
  0x40 0x41 0x42 0x43 0x44 0x45 0x46 0x47 -- 4
  0x48 0x49 0x4A 0x4B 0x4C 0x4D 0x4E 0x4F -- 4
  0x50 0x51 0x52 0x53 0x54 0x55 0x56 0x57 -- 5
  0x58 0x59 0x5A 0x5B 0x5C 0x5D 0x5E 0x5F -- 5
  0x60 0x61 0x62 0x63 0x64 0x65 0x66 0x67 -- 6
  0x68 0x69 0x6A 0x6B 0x6C 0x6D 0x6E 0x6F -- 6
  0x70 0x71 0x72 0x73 0x74 0x75 0x76 0x77 -- 7
  0x78 0x79 0x7A 0x7B 0x7C 0x7D 0x7E 0x7F -- 7
